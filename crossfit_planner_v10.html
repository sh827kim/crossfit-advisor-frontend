<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CrossFit Accessory Planner V10</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif; background-color: #f1f5f9; }
        
        /* Mobile Wrapper */
        .mobile-container { 
            max-width: 430px; 
            margin: 0 auto; 
            background: #ffffff; 
            min-height: 100vh; 
            position: relative; 
            box-shadow: 0 0 25px rgba(0,0,0,0.08); 
            display: flex; 
            flex-direction: column; 
        }

        .hide { display: none !important; }
        .fade-in { animation: fadeIn 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- UI Components --- */
        .main-card-btn {
            @apply w-full flex flex-col items-center justify-center p-6 mb-4 bg-white border border-gray-100 rounded-2xl shadow-sm hover:shadow-md transition-all duration-200 text-center h-44 relative overflow-hidden;
        }
        .main-card-btn:active { transform: scale(0.98); background-color: #f8fafc; }
        .accent-top { @apply absolute top-0 left-0 right-0 h-1.5; }

        .clean-btn {
            @apply w-full py-4 px-4 border border-gray-200 rounded-xl text-sm font-medium text-gray-500 bg-white transition-all duration-200 shadow-sm text-center;
        }
        .clean-btn.active {
            @apply border-blue-600 text-blue-600 font-bold bg-blue-50 ring-1 ring-blue-600 shadow-md;
        }

        .wod-list-item {
            @apply w-full flex items-center justify-between p-4 bg-blue-50 border border-blue-100 rounded-xl mb-2 shadow-sm;
        }
        .wod-text { @apply text-blue-900 font-bold text-sm truncate mr-2; }
        .wod-delete-btn { @apply text-gray-400 hover:text-red-500 transition p-1 flex-shrink-0; }

        .frequent-wod-box { @apply bg-slate-100 rounded-2xl p-4 mb-4 border border-slate-200; }
        .chip-btn { @apply bg-white text-slate-600 text-xs font-bold py-2.5 px-1 rounded-lg shadow-sm border border-slate-200 hover:border-slate-400 active:bg-slate-200 transition; }

        .time-btn { @apply flex items-center justify-center h-12 border border-gray-200 rounded-xl text-sm font-bold text-gray-400 bg-white transition-all duration-200 shadow-sm; }
        .time-btn.active { @apply bg-slate-800 text-white border-slate-800 shadow-md transform scale-105; }

        /* Login Buttons */
        .google-btn {
            @apply w-full flex items-center justify-center py-4 bg-white border border-gray-300 rounded-xl text-gray-700 font-bold shadow-sm hover:bg-gray-50 transition active:scale-95;
        }

        /* Autocomplete */
        .autocomplete-list {
            position: absolute; top: 100%; left: 0; right: 0;
            background: white; border: 1px solid #e2e8f0; border-radius: 0 0 16px 16px;
            max-height: 220px; overflow-y: auto; z-index: 50; 
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        .autocomplete-item { padding: 14px 16px; cursor: pointer; border-bottom: 1px solid #f1f5f9; font-size: 0.9rem; color: #334155; }
        
        /* Calendar */
        .calendar-day { aspect-ratio: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 0.8rem; border-radius: 50%; }
        .has-record { background-color: #2563eb; color: white; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div class="mobile-container">
    
    <header class="h-16 flex justify-between items-center px-6 bg-white z-20 sticky top-0 border-b border-gray-50">
        <div class="font-extrabold text-xl text-slate-800 tracking-tight cursor-pointer flex items-center" onclick="goHome()">
            <i class="fa-solid fa-dumbbell text-blue-600 mr-2.5"></i>Planner
        </div>
        <div class="flex gap-3">
            <button onclick="checkHistoryAccess()" class="w-10 h-10 rounded-full bg-gray-50 flex items-center justify-center text-gray-400 hover:text-blue-600 hover:bg-blue-50 transition">
                <i class="fa-solid fa-calendar-days text-lg"></i>
            </button>
            <button onclick="handleUserIconClick()" class="w-10 h-10 rounded-full bg-gray-50 flex items-center justify-center text-gray-400 hover:text-blue-600 hover:bg-blue-50 transition relative">
                <i class="fa-solid fa-user text-lg"></i>
                <div id="login-dot" class="absolute top-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white hide"></div>
            </button>
        </div>
    </header>

    <main id="page-home" class="px-6 pb-6 flex-grow flex flex-col pt-6 fade-in z-0">
        <div class="mb-6 text-center">
            <h2 class="text-2xl font-black text-slate-800 leading-tight mb-2">ì˜¤ëŠ˜ì˜ ìš´ë™ ëª©í‘œëŠ”?</h2>
            <p class="text-sm text-slate-500 font-medium">ìƒí™©ì— ë§ëŠ” ìµœì ì˜ ë£¨í‹´ì„ ì¶”ì²œí•´ë“œë ¤ìš”.</p>
        </div>
        
        <div class="flex flex-col w-full gap-3">
            <button onclick="goToInput('wod')" class="main-card-btn group">
                <div class="accent-top bg-green-500"></div>
                <div class="w-16 h-16 rounded-full bg-green-50 flex items-center justify-center mb-4 group-hover:scale-110 transition">
                    <i class="fa-solid fa-battery-full text-green-600 text-3xl"></i>
                </div>
                <h3 class="font-bold text-slate-800 text-lg">ë¶€ì¡±í•œ ë¶€ìœ„ ì±„ìš°ê¸°</h3>
                <p class="text-xs text-slate-400 font-medium mt-1">ì˜¤ëŠ˜ WODì—ì„œ ì•ˆ ì“´ ê·¼ìœ¡ ìœ„ì£¼</p>
            </button>

            <button onclick="goToInput('goal')" class="main-card-btn group">
                <div class="accent-top bg-purple-500"></div>
                <div class="w-16 h-16 rounded-full bg-purple-50 flex items-center justify-center mb-4 group-hover:scale-110 transition">
                    <i class="fa-solid fa-trophy text-purple-600 text-3xl"></i>
                </div>
                <h3 class="font-bold text-slate-800 text-lg">ë‚˜ì˜ ë‹¬ì„± ëª©í‘œ</h3>
                <p class="text-xs text-slate-400 font-medium mt-1">ë¨¸ìŠ¬ì—…, í•¸ë“œìŠ¤íƒ ë“œ ë“± ìŠ¤í‚¬</p>
            </button>

            <button onclick="goToInput('part')" class="main-card-btn group">
                <div class="accent-top bg-blue-500"></div>
                <div class="w-16 h-16 rounded-full bg-blue-50 flex items-center justify-center mb-4 group-hover:scale-110 transition">
                    <i class="fa-solid fa-bullseye text-blue-600 text-3xl"></i>
                </div>
                <h3 class="font-bold text-slate-800 text-lg">íƒ€ê²Ÿ ë¶€ìœ„ ì„ íƒ</h3>
                <p class="text-xs text-slate-400 font-medium mt-1">ì›í•˜ëŠ” ë¶€ìœ„ ì§‘ì¤‘ ê³µëµ</p>
            </button>
        </div>
    </main>

    <main id="page-login" class="px-6 pb-6 flex-grow flex flex-col justify-center hide fade-in">
        <div class="text-center mb-10">
            <div class="w-20 h-20 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fa-solid fa-lock text-3xl text-blue-600"></i>
            </div>
            <h2 class="text-2xl font-black text-slate-800 mb-2">ë¡œê·¸ì¸</h2>
            <p class="text-slate-500 text-sm">ìš´ë™ ê¸°ë¡ì„ ì €ì¥í•˜ê³  ê´€ë¦¬í•˜ë ¤ë©´<br>ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
        </div>
        
        <button onclick="simulateGoogleLogin()" class="google-btn mb-4">
            <img src="https://www.svgrepo.com/show/475656/google-color.svg" class="w-5 h-5 mr-3" alt="Google">
            Google ê³„ì •ìœ¼ë¡œ ê³„ì†í•˜ê¸°
        </button>
        
        <button onclick="goHome()" class="text-sm text-slate-400 mt-4 underline">ë‹¤ìŒì— í•˜ê¸°</button>
    </main>

    <main id="page-profile" class="px-6 pb-6 flex-grow flex flex-col hide fade-in">
        <button onclick="goHome()" class="text-sm font-bold text-slate-400 mb-6 flex items-center w-fit hover:text-slate-800 transition">
            <i class="fa-solid fa-arrow-left mr-2"></i> ë©”ì¸ìœ¼ë¡œ
        </button>
        
        <div class="bg-white rounded-3xl p-8 shadow-lg shadow-gray-100 text-center border border-gray-50 mt-10">
            <div class="w-24 h-24 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4 text-4xl text-blue-600 border-4 border-white shadow-sm">
                <i class="fa-solid fa-user-astronaut"></i>
            </div>
            <h2 class="text-xl font-black text-slate-800 mb-1" id="profile-name">ì‚¬ìš©ì</h2>
            <p class="text-sm text-slate-400 mb-6" id="profile-email">user@example.com</p>
            
            <div class="bg-blue-50 rounded-xl p-4 mb-6">
                <p class="text-blue-800 text-sm font-bold">ì´ë²ˆ ë‹¬ ìš´ë™ íšŸìˆ˜</p>
                <p class="text-3xl font-black text-blue-600 mt-1" id="profile-count">0íšŒ</p>
            </div>

            <button onclick="logout()" class="w-full py-3 border border-red-200 text-red-500 rounded-xl font-bold hover:bg-red-50 transition">
                ë¡œê·¸ì•„ì›ƒ
            </button>
        </div>
    </main>

    <main id="page-input" class="px-6 pb-6 flex-grow flex flex-col hide fade-in">
        <button onclick="goHome()" class="text-sm font-bold text-slate-400 mb-6 flex items-center w-fit hover:text-slate-800 transition">
            <i class="fa-solid fa-arrow-left mr-2"></i> ì´ì „ìœ¼ë¡œ
        </button>

        <div class="mb-6">
            <h2 id="input-title" class="text-2xl font-black text-slate-800 mb-1">ì œëª©</h2>
            <p id="input-desc" class="text-sm text-slate-500 font-medium">ì„¤ëª…</p>
        </div>

        <div id="section-wod" class="input-section hide">
            <div class="relative mb-6 z-30">
                <div class="flex gap-2 shadow-sm rounded-xl">
                    <input type="text" id="wod-input" placeholder="ìš´ë™ ê²€ìƒ‰ (ì´ˆì„±: ã……ã„´ã…Š)" 
                           class="flex-grow bg-white border border-gray-200 rounded-xl p-4 text-sm focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-100 font-bold text-slate-700 placeholder-gray-300 transition" autocomplete="off">
                    <button onclick="addWodMove()" class="bg-slate-800 text-white px-5 rounded-xl text-sm font-bold hover:bg-slate-700 transition shadow-md">ì¶”ê°€</button>
                </div>
                <div id="autocomplete-list" class="autocomplete-list hide"></div>
            </div>

            <div class="frequent-wod-box">
                <p class="text-xs font-bold text-slate-400 mb-3 flex items-center uppercase tracking-wide">
                    <i class="fa-solid fa-bolt text-yellow-500 mr-1.5"></i> ìì£¼ ë‚˜ì˜¤ëŠ” WOD
                </p>
                <div class="grid grid-cols-3 gap-2" id="frequent-wod-list">
                    </div>
            </div>

            <div id="selected-list-container" class="hide mt-2">
                <p class="text-xs font-bold text-blue-500 mb-2 ml-1">ì˜¤ëŠ˜ í•œ ìš´ë™ ëª©ë¡</p>
                <div id="selected-moves" class="flex flex-col w-full"></div>
            </div>
        </div>

        <div id="section-goal" class="input-section hide mb-8">
            <div class="flex flex-col gap-3" id="goal-list-container"></div>
        </div>

        <div id="section-part" class="input-section hide mb-8">
            <div class="flex flex-col gap-3">
                <button onclick="togglePart(this, 'core')" class="clean-btn part-btn" data-part="core">ë³µê·¼ / ì½”ì–´</button>
                <button onclick="togglePart(this, 'legs')" class="clean-btn part-btn" data-part="legs">í•˜ì²´ / í™</button>
                <button onclick="togglePart(this, 'back')" class="clean-btn part-btn" data-part="back">ë“± / ê´‘ë°°</button>
                <button onclick="togglePart(this, 'chest')" class="clean-btn part-btn" data-part="chest">ê°€ìŠ´ / ì–´ê¹¨</button>
                <button onclick="togglePart(this, 'cardio')" class="clean-btn part-btn" data-part="cardio">ìœ ì‚°ì†Œ</button>
            </div>
        </div>

        <div class="mt-auto pt-6 border-t border-gray-100">
            <label class="block text-sm font-bold text-slate-700 mb-4 flex items-center">
                <div class="w-1 h-4 bg-slate-800 mr-2 rounded-full"></div> ìš´ë™ ì‹œê°„ ì„¤ì •
            </label>
            <div class="grid grid-cols-5 gap-2 mb-6">
                <button onclick="selectTime(this, 1)" class="time-btn" data-val="5">5ë¶„</button>
                <button onclick="selectTime(this, 10)" class="time-btn" data-val="10">10ë¶„</button>
                <button onclick="selectTime(this, 15)" class="time-btn" data-val="15">15ë¶„</button>
                <button onclick="selectTime(this, 20)" class="time-btn" data-val="20">20ë¶„</button>
                <button onclick="selectTime(this, 25)" class="time-btn" data-val="25">25ë¶„</button>
                <button onclick="selectTime(this, 30)" class="time-btn" data-val="30">30ë¶„</button>
            </div>

            <button onclick="generateWorkout()" class="w-full bg-slate-900 hover:bg-slate-800 text-white font-bold py-4 rounded-2xl shadow-xl shadow-slate-200 transition transform active:scale-[0.98] flex justify-center items-center text-lg">
                <span id="btn-generate-text">10ë¶„ ìš´ë™ ê³„íš ìƒì„±í•˜ê¸°</span>
            </button>
        </div>
    </main>

    <main id="page-result" class="px-6 pb-6 flex-grow flex flex-col hide fade-in">
        <div class="pt-6 mb-6 text-center">
            <p class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">Workout Plan</p>
            <h1 id="result-headline" class="text-3xl font-black text-slate-800">Result</h1>
            <p id="target-time-per-round" class="text-sm font-bold text-blue-600 mt-2 bg-blue-50 inline-block px-3 py-1 rounded-full"></p>
        </div>

        <div class="bg-white border border-gray-100 rounded-3xl p-6 shadow-lg shadow-gray-100 mb-6 flex-grow overflow-y-auto">
            <div class="flex justify-between items-center mb-6 pb-4 border-b border-gray-100">
                <span id="result-mode-text" class="bg-slate-100 text-slate-600 text-xs font-bold px-3 py-1.5 rounded-full">Mode</span>
                <span id="result-time-display" class="text-slate-800 font-bold flex items-center"><i class="fa-regular fa-clock mr-1.5 text-slate-400"></i> 10ë¶„</span>
            </div>
            <ul id="workout-list" class="space-y-4"></ul>
        </div>

        <div class="bg-slate-900 text-white rounded-3xl p-6 text-center shadow-xl shadow-slate-200">
            <div id="timer-display" class="text-6xl font-mono font-bold mb-6 tracking-tighter">00:00</div>
            <div id="timer-controls">
                <button onclick="startTimer()" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-4 rounded-2xl transition shadow-lg shadow-green-900/20 text-lg">
                    ìš´ë™ ì‹œì‘ <i class="fa-solid fa-play ml-2 text-sm"></i>
                </button>
            </div>
            <button id="btn-complete" onclick="saveRecord()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-2xl transition hide shadow-lg shadow-blue-900/20 text-lg">
                ì˜¤ëŠ˜ ìš´ë™ ê¸°ë¡í•˜ê¸° <i class="fa-solid fa-pen-to-square ml-2"></i>
            </button>
        </div>
        <button onclick="goHome()" class="mt-6 text-center text-slate-400 text-sm font-medium hover:text-slate-600">ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
    </main>

    <main id="page-history" class="px-6 pb-6 flex-grow flex flex-col hide fade-in">
        <div class="h-16 flex items-center mb-2">
            <button onclick="goHome()" class="text-slate-400 hover:text-slate-800 transition mr-4"><i class="fa-solid fa-arrow-left text-xl"></i></button>
            <h2 class="text-2xl font-black text-slate-800">ìš´ë™ ê¸°ë¡</h2>
        </div>
        <div class="bg-white rounded-3xl shadow-lg shadow-gray-100 border border-gray-50 p-6 mb-6">
            <div class="text-center font-bold text-lg mb-6 text-slate-800" id="cal-header"></div>
            <div class="grid grid-cols-7 gap-2 text-center mb-2 text-xs font-bold text-slate-300">
                <div>ì¼</div><div>ì›”</div><div>í™”</div><div>ìˆ˜</div><div>ëª©</div><div>ê¸ˆ</div><div>í† </div>
            </div>
            <div id="calendar-grid" class="grid grid-cols-7 gap-2"></div>
        </div>
        <div id="history-detail" class="bg-slate-50 rounded-2xl p-6 flex-grow overflow-y-auto border border-slate-100"></div>
    </main>

</div>

<script>
    // --- 0. Auth & State ---
    let state = {
        currentUser: null, // { name: '...', email: '...' }
        mode: '',
        wodList: [],
        selectedGoal: '',
        selectedParts: [],
        totalTime: 10,
        workout: []
    };
    let timerInterval;

    // --- 1. Auth Logic ---
    function handleUserIconClick() {
        if(state.currentUser) {
            updateProfileUI();
            showPage('profile');
        } else {
            showPage('login');
        }
    }

    function simulateGoogleLogin() {
        // Mock Login Process
        const btn = document.querySelector('.google-btn');
        btn.innerHTML = `<i class="fa-solid fa-circle-notch fa-spin mr-2"></i> ë¡œê·¸ì¸ ì¤‘...`;
        
        setTimeout(() => {
            state.currentUser = {
                name: 'ê¹€í¬ë¡œìŠ¤í•',
                email: 'crossfitter@gmail.com'
            };
            document.getElementById('login-dot').classList.remove('hide');
            alert(`í™˜ì˜í•©ë‹ˆë‹¤, ${state.currentUser.name}ë‹˜!`);
            goHome();
            // Reset button for next time
            btn.innerHTML = `<img src="https://www.svgrepo.com/show/475656/google-color.svg" class="w-5 h-5 mr-3" alt="Google">Google ê³„ì •ìœ¼ë¡œ ê³„ì†í•˜ê¸°`;
        }, 1000);
    }

    function logout() {
        if(confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            state.currentUser = null;
            document.getElementById('login-dot').classList.add('hide');
            goHome();
        }
    }

    function checkHistoryAccess() {
        if(!state.currentUser) {
            if(confirm('ìš´ë™ ê¸°ë¡ì„ ë³´ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.\në¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í• ê¹Œìš”?')) {
                showPage('login');
            }
        } else {
            showPage('history');
            renderCalendar();
        }
    }

    function updateProfileUI() {
        if(state.currentUser) {
            document.getElementById('profile-name').innerText = state.currentUser.name;
            document.getElementById('profile-email').innerText = state.currentUser.email;
            
            // Calculate Count
            const history = JSON.parse(localStorage.getItem('cf_history_v10')) || [];
            // Simple logic: count all records (in real app, filter by this month/user)
            document.getElementById('profile-count').innerText = `${history.length}íšŒ`;
        }
    }

    // --- 2. Data & Init ---
    const allCrossFitMovements = [
        "ìŠ¤ë‚´ì¹˜", "íŒŒì›Œ ìŠ¤ë‚´ì¹˜", "ìŠ¤ì¿¼íŠ¸ ìŠ¤ë‚´ì¹˜", "í–‰ ìŠ¤ë‚´ì¹˜", "ë¤ë²¨ ìŠ¤ë‚´ì¹˜",
        "í´ë¦°", "íŒŒì›Œ í´ë¦°", "ìŠ¤ì¿¼íŠ¸ í´ë¦°", "í–‰ í´ë¦°", "í´ë¦° ì•¤ ì €í¬",
        "ì €í¬", "í‘¸ì‰¬ ì €í¬", "ìŠ¤í”Œë¦¿ ì €í¬",
        "ë°ë“œë¦¬í”„íŠ¸", "ìŠ¤ëª¨ ë°ë“œë¦¬í”„íŠ¸",
        "ìŠ¤ì¿¼íŠ¸", "ë°± ìŠ¤ì¿¼íŠ¸", "í”„ë¡ íŠ¸ ìŠ¤ì¿¼íŠ¸", "ì˜¤ë²„í—¤ë“œ ìŠ¤ì¿¼íŠ¸", "ì—ì–´ ìŠ¤ì¿¼íŠ¸",
        "ëŸ°ì§€", "ì˜¤ë²„í—¤ë“œ ëŸ°ì§€", "ë¤ë²¨ ëŸ°ì§€",
        "ì“°ëŸ¬ìŠ¤í„°", "ë¤ë²¨ ì“°ëŸ¬ìŠ¤í„°",
        "ì›”ë³¼ ìƒ·", "ì›”ì›Œí¬",
        "í’€ì—…", "í‚¤í•‘ í’€ì—…", "ë²„í„°í”Œë¼ì´ í’€ì—…", "ì²´ìŠ¤íŠ¸ íˆ¬ ë°”", 
        "ë¨¸ìŠ¬ì—…", "ë°” ë¨¸ìŠ¬ì—…", "ë§ ë¨¸ìŠ¬ì—…",
        "í† íˆ¬ë°”", "ë‹ˆíˆ¬ì—˜ë³´",
        "í‘¸ì‰¬ì—…", "í•¸ë“œìŠ¤íƒ ë“œ í‘¸ì‰¬ì—…", "ë§ ë”¥ìŠ¤", "ë°” ë”¥ìŠ¤",
        "ë¡œì‰", "ì–´ì°íŠ¸ ë°”ì´í¬", "ë”ë¸”ì–¸ë”", "ë°•ìŠ¤ ì í”„", "ë²„í”¼", "ë²„í”¼ ë°•ìŠ¤ ì í”„"
    ];

    const frequentWodKeywords = ["ìŠ¤ë‚´ì¹˜", "í´ë¦°", "í’€ì—…", "ë¡œì‰", "ë”ë¸”ì–¸ë”", "ì›”ì›Œí¬", "ë°•ìŠ¤ì í”„", "ë²„í”¼", "ë²„í”¼ë°•ì "];

    const goalsList = ["í‚¤í•‘ í’€ì—…", "ìŠ¤íŠ¸ë¦­ í’€ì—…", "ë²„í„°í”Œë¼ì´ í’€ì—…", "í† íˆ¬ë°”", "ì²´ìŠ¤íŠ¸ íˆ¬ ë°”", "ë°” ë¨¸ìŠ¬ì—…", "ë§ ë¨¸ìŠ¬ì—…", "í•¸ë“œìŠ¤íƒ ë“œ ì›Œí¬"];

    const db = [
        { name: "í• ë¡œìš° ë½", parts: ["core"], tools: ["ë§¨ëª¸"] },
        { name: "í”Œë­í¬", parts: ["core"], tools: ["ë§¨ëª¸"] },
        { name: "GHD ì‹¯ì—…", parts: ["core"], tools: ["GHD"] }, 
        { name: "í–‰ì‰ ë ˆê·¸ë ˆì´ì¦ˆ", parts: ["core"], tools: ["ì² ë´‰"] },
        { name: "V-up", parts: ["core"], tools: ["ë§¨ëª¸"] },
        { name: "ë°´ë“œ í’€ë‹¤ìš´", parts: ["back", "lats"], tools: ["ë°´ë“œ"] },
        { name: "ë§ ë¡œìš°", parts: ["back"], tools: ["ë§"] },
        { name: "ìŠ¤ìºí’€ë¼ í’€ì—…", parts: ["back"], tools: ["ì² ë´‰"] },
        { name: "ë„¤ê±°í‹°ë¸Œ í’€ì—…", parts: ["back"], tools: ["ì² ë´‰"] },
        { name: "ë²¤íŠ¸ì˜¤ë²„ ë°”ë²¨ë¡œìš°", parts: ["back"], tools: ["ë°”ë²¨"] },
        { name: "ë§ ë”¥ìŠ¤", parts: ["chest", "arm"], tools: ["ë§"] },
        { name: "í‘¸ì‰¬ì—…", parts: ["chest", "arm"], tools: ["ë§¨ëª¸"] },
        { name: "ë°•ìŠ¤ ë”¥ìŠ¤", parts: ["arm"], tools: ["ë°•ìŠ¤"] },
        { name: "ë¤ë²¨ ë²¤ì¹˜í”„ë ˆìŠ¤", parts: ["chest"], tools: ["ë¤ë²¨"] },
        { name: "ë¶ˆê°€ë¦¬ì•ˆ ìŠ¤í”Œë¦¿ ìŠ¤ì¿¼íŠ¸", parts: ["legs"], tools: ["ë§¨ëª¸", "ë¤ë²¨"] },
        { name: "ë¤ë²¨ ëŸ°ì§€", parts: ["legs"], tools: ["ë¤ë²¨"] },
        { name: "ê³ ë¸”ë¦¿ ìŠ¤ì¿¼íŠ¸", parts: ["legs"], tools: ["ì¼€í‹€ë²¨"] },
        { name: "ì›”ë³¼ ìƒ·", parts: ["legs", "cardio"], tools: ["ì›”ë³¼"] },
        { name: "ë°•ìŠ¤ ì í”„", parts: ["legs", "cardio"], tools: ["ë°•ìŠ¤"] },
        { name: "í•¸ë“œìŠ¤íƒ ë“œ í™€ë“œ", parts: ["shoulder"], tools: ["ë²½"] },
        { name: "íŒŒì´í¬ í‘¸ì‰¬ì—…", parts: ["shoulder"], tools: ["ë°•ìŠ¤"] },
        { name: "ë¤ë²¨ ìˆ„ë” í”„ë ˆìŠ¤", parts: ["shoulder"], tools: ["ë¤ë²¨"] },
        { name: "ì–´ì°íŠ¸ ë°”ì´í¬ (ì¸í„°ë²Œ)", parts: ["cardio", "legs"], tools: ["ì–´ì°íŠ¸ ë°”ì´í¬"] },
        { name: "ë¡œì‰ ë¨¸ì‹  (ì¸í„°ë²Œ)", parts: ["cardio", "back"], tools: ["ë¡œì‰"] },
        { name: "ë²„í”¼", parts: ["cardio", "full"], tools: ["ë§¨ëª¸"] }
    ];

    // --- Init ---
    document.addEventListener('DOMContentLoaded', () => {
        renderFrequentWod();
        renderGoals();
        const defaultTimeBtn = document.querySelector('.time-btn[data-val="10"]');
        if(defaultTimeBtn) selectTime(defaultTimeBtn, 10);
        setupAutocomplete();
    });

    // --- Navigation ---
    function hideAllPages() {
        document.querySelectorAll('main').forEach(el => el.classList.add('hide'));
    }

    function goHome() {
        hideAllPages();
        document.getElementById('page-home').classList.remove('hide');
        resetState();
    }

    function showPage(pageId) {
        hideAllPages();
        document.getElementById(`page-${pageId}`).classList.remove('hide');
    }

    function goToInput(mode) {
        state.mode = mode;
        hideAllPages();
        document.getElementById('page-input').classList.remove('hide');

        document.querySelectorAll('.input-section').forEach(el => el.classList.add('hide'));
        const title = document.getElementById('input-title');
        const desc = document.getElementById('input-desc');

        if(mode === 'wod') {
            document.getElementById('section-wod').classList.remove('hide');
            title.innerText = "ì˜¤ëŠ˜ì˜ WOD";
            desc.innerText = "ì˜¤ëŠ˜ ìˆ˜í–‰í•œ ìš´ë™ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.";
        } else if(mode === 'goal') {
            document.getElementById('section-goal').classList.remove('hide');
            title.innerText = "ë‚˜ì˜ ë‹¬ì„± ëª©í‘œ";
            desc.innerText = "ì—°ìŠµí•˜ê³  ì‹¶ì€ ìŠ¤í‚¬ì„ ì„ íƒí•´ì£¼ì„¸ìš”.";
        } else if(mode === 'part') {
            document.getElementById('section-part').classList.remove('hide');
            title.innerText = "íƒ€ê²Ÿ ë¶€ìœ„";
            desc.innerText = "ì§‘ì¤‘ì ìœ¼ë¡œ ìš´ë™í•  ë¶€ìœ„ë¥¼ ì„ íƒí•˜ì„¸ìš”.";
        }
    }

    // --- Rendering ---
    function renderFrequentWod() {
        const container = document.getElementById('frequent-wod-list');
        if(container) {
            container.innerHTML = frequentWodKeywords.map(k => 
                `<button onclick="addWodMove('${k}')" class="chip-btn">${k}</button>`
            ).join('');
        }
    }

    function renderGoals() {
        const container = document.getElementById('goal-list-container');
        if(container) {
            container.innerHTML = goalsList.map(g => 
                `<button onclick="selectGoal(this, '${g}')" class="clean-btn goal-btn">${g}</button>`
            ).join('');
        }
    }

    // --- Autocomplete ---
    function getChosung(str) {
        const cho = ["ã„±","ã„²","ã„´","ã„·","ã„¸","ã„¹","ã…","ã…‚","ã…ƒ","ã……","ã…†","ã…‡","ã…ˆ","ã…‰","ã…Š","ã…‹","ã…Œ","ã…","ã…"];
        let result = "";
        for(let i=0; i<str.length; i++) {
            const code = str.charCodeAt(i) - 44032;
            if(code > -1 && code < 11172) result += cho[Math.floor(code/588)];
            else result += str.charAt(i);
        }
        return result;
    }

    function setupAutocomplete() {
        const input = document.getElementById('wod-input');
        const list = document.getElementById('autocomplete-list');

        input.addEventListener('input', function() {
            const val = this.value;
            list.innerHTML = '';
            if(!val) { list.classList.add('hide'); return; }
            list.classList.remove('hide');

            const valChosung = getChosung(val);
            const matches = allCrossFitMovements.filter(item => {
                return item.includes(val) || getChosung(item).includes(valChosung);
            });

            if(matches.length === 0) { list.classList.add('hide'); return; }

            matches.forEach(m => {
                const div = document.createElement('div');
                div.className = 'autocomplete-item';
                div.innerHTML = m.replace(val, `<span class='font-bold text-blue-600'>${val}</span>`);
                div.onclick = () => { input.value = ''; addWodMove(m); list.classList.add('hide'); };
                list.appendChild(div);
            });
        });
        document.addEventListener('click', (e) => { if(e.target !== input) list.classList.add('hide'); });
    }

    // --- Logic: Select ---
    function selectGoal(el, goal) {
        state.selectedGoal = goal;
        document.querySelectorAll('.goal-btn').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
    }

    function togglePart(el, part) {
        if(state.selectedParts.includes(part)) {
            state.selectedParts = state.selectedParts.filter(p => p !== part);
            el.classList.remove('active');
        } else {
            state.selectedParts.push(part);
            el.classList.add('active');
        }
    }

    function selectTime(el, val) {
        state.totalTime = val;
        document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
        const btnText = document.getElementById('btn-generate-text');
        if(btnText) btnText.innerText = `${val}ë¶„ ìš´ë™ ê³„íš ìƒì„±í•˜ê¸°`;
    }

    // --- Logic: WOD List ---
    const wodInput = document.getElementById('wod-input');
    function addWodMove(val) {
        const v = val || wodInput.value.trim();
        if(!v) return;
        if(!state.wodList.includes(v)) {
            state.wodList.push(v);
            renderWodList();
        }
        wodInput.value = '';
        document.getElementById('autocomplete-list').classList.add('hide');
    }

    function removeWodMove(idx) {
        state.wodList.splice(idx, 1);
        renderWodList();
    }

    function renderWodList() {
        const container = document.getElementById('selected-moves');
        const wrapper = document.getElementById('selected-list-container');
        if(state.wodList.length === 0) { wrapper.classList.add('hide'); return; }
        wrapper.classList.remove('hide');
        
        container.innerHTML = state.wodList.map((m, i) => 
            `<div class="wod-list-item">
                <span class="wod-text">${m}</span>
                <button onclick="removeWodMove(${i})" class="wod-delete-btn"><i class="fa-solid fa-xmark text-lg"></i></button>
            </div>`
        ).join('');
    }

    // --- Algorithm ---
    function generateWorkout() {
        if(state.mode === 'wod' && state.wodList.length === 0) { if(!confirm("ì…ë ¥ëœ WODê°€ ì—†ìŠµë‹ˆë‹¤. ì „ì‹  ë³´ì¡°ìš´ë™ì„ ì¶”ì²œí• ê¹Œìš”?")) return; }
        if(state.mode === 'goal' && !state.selectedGoal) { alert('ëª©í‘œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; }
        if(state.mode === 'part' && state.selectedParts.length === 0) { alert('íƒ€ê²Ÿ ë¶€ìœ„ë¥¼ í•˜ë‚˜ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; }

        let candidates = [];
        if(state.mode === 'part') candidates = db.filter(ex => ex.parts.some(p => state.selectedParts.includes(p)));
        else if(state.mode === 'goal') {
            const g = state.selectedGoal;
            if(g.includes("í’€ì—…") || g.includes("í† íˆ¬ë°”") || g.includes("ì²´ìŠ¤íŠ¸")) candidates = db.filter(ex => ex.parts.includes('back') || ex.parts.includes('core'));
            else if(g.includes("ë¨¸ìŠ¬ì—…")) candidates = db.filter(ex => ex.name.includes("ë”¥ìŠ¤") || ex.parts.includes('back') || ex.parts.includes('chest'));
            else if(g.includes("í•¸ë“œìŠ¤íƒ ë“œ")) candidates = db.filter(ex => ex.parts.includes('shoulder') || ex.parts.includes('core'));
            else candidates = db; 
        } else { // WOD
            const wodStr = state.wodList.join('');
            const avoidLegs = wodStr.match(/ìŠ¤ì¿¼íŠ¸|ëŸ°ì§€|ì“°ëŸ¬ìŠ¤í„°|ë°•ìŠ¤|ì›”ë³¼|í´ë¦°|ìŠ¤ë‚´ì¹˜/);
            const avoidPush = wodStr.match(/í”„ë ˆìŠ¤|í‘¸ì‰¬|ì €í¬|ë²„í”¼|ì›”ë³¼|í•¸ë“œìŠ¤íƒ ë“œ/);
            const avoidPull = wodStr.match(/í’€ì—…|ë¡œì‰|í´ë¦°|ìŠ¤ë‚´ì¹˜|í† íˆ¬ë°”|ë¨¸ìŠ¬ì—…/);
            candidates = db.filter(ex => {
                if(avoidLegs && ex.parts.includes('legs')) return false;
                if(avoidPush && (ex.parts.includes('chest') || ex.parts.includes('shoulder'))) return false;
                if(avoidPull && (ex.parts.includes('back'))) return false;
                return true;
            });
            if(candidates.length === 0) candidates = db.filter(ex => ex.parts.includes('core'));
        }

        let count = Math.ceil(state.totalTime / 10) + 1; 
        if(count > 4) count = 4;
        
        state.workout = [];
        const pool = [...candidates];
        pool.sort(() => Math.random() - 0.5);
        for(let i=0; i<count; i++) { if(pool[i]) state.workout.push(pool[i]); }
        if(state.workout.length === 0) state.workout = [db[0], db[1]];

        renderResult();
        showPage('result');
    }

    function renderResult() {
        document.getElementById('result-time-display').innerHTML = `<i class="fa-regular fa-clock mr-1.5 text-slate-400"></i> ${state.totalTime}ë¶„`;
        let modeTxt = "";
        if(state.mode === 'wod') modeTxt = "ë¶€ì¡± ë¶€ìœ„ ì±„ìš°ê¸°"; 
        else if(state.mode === 'goal') modeTxt = "ëª©í‘œ ë‹¬ì„±";
        else modeTxt = "íƒ€ê²Ÿ ì§‘ì¤‘";
        document.getElementById('result-mode-text').innerText = modeTxt;

        const rounds = Math.max(3, Math.floor(state.totalTime / 3));
        const timePerRoundSeconds = (state.totalTime * 60) / rounds;
        const tprMin = Math.floor(timePerRoundSeconds / 60);
        const tprSec = Math.floor(timePerRoundSeconds % 60);
        
        document.getElementById('result-headline').innerText = `${rounds} Rounds Quality`;
        document.getElementById('target-time-per-round').innerText = `1ë¼ìš´ë“œë‹¹ ëª©í‘œ: ${tprMin}ë¶„ ${tprSec}ì´ˆ`;
        
        const list = document.getElementById('workout-list');
        list.innerHTML = state.workout.map(ex => `
            <li class="flex items-start p-4 bg-slate-50 border border-slate-100 rounded-2xl">
                <div class="bg-white p-2.5 rounded-xl mr-3 text-blue-600 shadow-sm border border-gray-100"><i class="fa-solid fa-dumbbell"></i></div>
                <div>
                    <div class="font-bold text-slate-800 text-lg">${ex.name}</div>
                    <div class="text-sm text-slate-500 mt-1 font-medium">
                        <span class="bg-white border px-2 py-0.5 rounded text-xs">10-15 reps</span>
                        <span class="text-xs ml-1 text-slate-400">(${ex.tools.join(', ')})</span>
                    </div>
                </div>
            </li>
        `).join('');

        if(timerInterval) clearInterval(timerInterval);
        document.getElementById('timer-display').innerText = `${state.totalTime}:00`;
        document.getElementById('timer-controls').classList.remove('hide');
        document.getElementById('btn-complete').classList.add('hide');
    }

    function startTimer() {
        let seconds = state.totalTime * 60;
        document.getElementById('timer-controls').classList.add('hide');
        const display = document.getElementById('timer-display');
        timerInterval = setInterval(() => {
            seconds--;
            const m = Math.floor(seconds / 60);
            const s = seconds % 60;
            display.innerText = `${m}:${s<10?'0'+s:s}`;
            if(seconds <= 0) {
                clearInterval(timerInterval);
                display.innerText = "DONE!";
                document.getElementById('btn-complete').classList.remove('hide');
            }
        }, 1000); 
    }

    function saveRecord() {
        if(!state.currentUser) {
            if(confirm('ê¸°ë¡ì„ ì €ì¥í•˜ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.\në¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™í• ê¹Œìš”?')) { showPage('login'); return; }
        }
        const history = JSON.parse(localStorage.getItem('cf_history_v10')) || [];
        const record = {
            date: new Date().toISOString().split('T')[0],
            mode: state.mode,
            time: state.totalTime,
            exercises: state.workout.map(e => e.name)
        };
        history.push(record);
        localStorage.setItem('cf_history_v10', JSON.stringify(history));
        alert('ìš´ë™ ê¸°ë¡ ì €ì¥ ì™„ë£Œ! ğŸ”¥');
        showPage('history');
        renderCalendar();
    }

    function renderCalendar() {
        const today = new Date();
        const y = today.getFullYear();
        const m = today.getMonth();
        document.getElementById('cal-header').innerText = `${y}ë…„ ${m+1}ì›”`;
        const firstDay = new Date(y, m, 1).getDay();
        const daysInMonth = new Date(y, m+1, 0).getDate();
        const history = JSON.parse(localStorage.getItem('cf_history_v10')) || [];
        const dates = history.map(h => h.date);
        const grid = document.getElementById('calendar-grid');
        grid.innerHTML = '';
        for(let i=0; i<firstDay; i++) grid.innerHTML += `<div></div>`;
        for(let i=1; i<=daysInMonth; i++) {
            const dStr = `${y}-${String(m+1).padStart(2,'0')}-${String(i).padStart(2,'0')}`;
            const has = dates.includes(dStr);
            grid.innerHTML += `<div class="calendar-day ${has?'has-record':''}" onclick="viewHistory('${dStr}')">${i}</div>`;
        }
    }

    function viewHistory(date) {
        const history = JSON.parse(localStorage.getItem('cf_history_v10')) || [];
        const recs = history.filter(h => h.date === date);
        const con = document.getElementById('history-detail');
        if(recs.length === 0) { con.innerHTML = `<p class="text-gray-400 text-center mt-4 text-sm font-bold">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>`; return; }
        con.innerHTML = `<h3 class="font-black mb-4 sticky top-0 bg-slate-50 pb-2 border-b border-slate-200 text-slate-800">${date}</h3>` + recs.map(r => `
            <div class="bg-white p-5 rounded-2xl mb-3 shadow-sm border border-slate-100">
                <div class="flex justify-between mb-3 items-center">
                    <span class="text-xs font-bold bg-slate-100 text-slate-600 px-3 py-1 rounded-full">${r.mode==='wod'?'ë¶€ì¡±ë¶€ìœ„':(r.mode==='goal'?'ëª©í‘œ':'íƒ€ê²Ÿ')}</span>
                    <span class="text-sm font-bold text-blue-600">${r.time}ë¶„</span>
                </div>
                <div class="text-sm text-slate-700 leading-relaxed font-medium">${r.exercises.join(', ')}</div>
            </div>
        `).join('');
    }

    function resetState() {
        state.wodList = [];
        state.selectedGoal = '';
        state.selectedParts = [];
        state.totalTime = 10;
        document.getElementById('wod-input').value = '';
        renderWodList();
        document.querySelectorAll('.clean-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('active'));
        const defBtn = document.querySelector('.time-btn[data-val="10"]');
        if(defBtn) defBtn.classList.add('active');
        const btnText = document.getElementById('btn-generate-text');
        if(btnText) btnText.innerText = `10ë¶„ ìš´ë™ ê³„íš ìƒì„±í•˜ê¸°`;
    }
</script>
</body>
</html>